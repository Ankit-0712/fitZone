<div class="tracker-container">
  <!-- Stats Dashboard -->
  <div class="stats-dashboard">
    <div class="stat-card level-card">
      <div class="level-info">
        <h2>Level {{ level }}</h2>
        <div class="xp-info">
          <span class="xp-text">{{ totalXP }} XP</span>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getLevelProgress()"></div>
          </div>
          <span class="xp-needed">{{ xpForNextLevel - (totalXP - ((level - 1) * 100)) }} XP to next level</span>
        </div>
      </div>
    </div>

    <div class="stat-card streak-card">
      <h3>üî• Current Streak</h3>
      <div class="streak-number">{{ currentStreak }}</div>
      <p>days</p>
      <div class="longest-streak">Longest: {{ longestStreak }} days</div>
    </div>

    <div class="stat-card total-card">
      <h3>üí™ Total Workouts</h3>
      <div class="total-number">{{ totalWorkouts }}</div>
      <p>completed</p>
    </div>
  </div>

  <!-- Accordion Section Start -->
  <div class="accordion">
    <!-- Workout Logging (Open by default) -->
    <div class="accordion-item">
      <div class="accordion-header" (click)="toggleSection('log')">
        <h2>Log Today's Workout</h2>
        <span class="accordion-icon">{{ openSection === 'log' ? '‚àí' : '+' }}</span>
      </div>
      <div class="accordion-body" *ngIf="openSection === 'log'">
        <div class="tracker-card">
          <h1>Log Today's Workout</h1>
          <form (ngSubmit)="addLog()" class="log-form">
            <div class="form-row">
              <select [(ngModel)]="workoutType" name="workoutType" class="workout-type-select">
                <option *ngFor="let type of workoutTypes" [value]="type.value">
                  {{ type.label }} (+{{ type.xp }} XP)
                </option>
              </select>
            </div>
            <div class="form-row">
              <input
                type="text"
                [(ngModel)]="workoutNote"
                name="workoutNote"
                placeholder="What did you do today? (e.g. Chest day, 5km run...)"
                maxlength="100"
                required
                class="workout-input"
              />
              <button type="submit" class="log-btn">Log Workout</button>
            </div>
          </form>

          <!-- Recent Logs -->
          <div class="logs-list" *ngIf="logs.length > 0">
            <h2>Recent Workouts</h2>
            <ul>
              <li *ngFor="let log of logs; let i = index" class="log-item">
                <div class="log-header">
                  <span class="log-date">{{ log.date }}</span>
                  <span class="log-xp">+{{ log.xp }} XP</span>
                </div>
                <div class="log-content">
                  <span class="log-note">{{ log.note }}</span>
                  <span class="log-type">{{ getWorkoutTypeLabel(log.type) }}</span>
                </div>
                <button class="delete-btn" (click)="deleteLog(i)" title="Delete">&times;</button>
              </li>
            </ul>
          </div>
          <div class="empty-state" *ngIf="logs.length === 0">
            <p>No workouts logged yet. Start tracking your progress!</p>
          </div>
        </div>
      </div>
    </div>

    <!-- BMI Calculator -->
    <div class="accordion-item">
      <div class="accordion-header" (click)="toggleSection('bmi')">
        <h2>BMI Calculator</h2>
        <span class="accordion-icon">{{ openSection === 'bmi' ? '‚àí' : '+' }}</span>
      </div>
      <div class="accordion-body" *ngIf="openSection === 'bmi'">
        <div class="bmi-section">
          <h2>üßÆ BMI Calculator</h2>
          <form (ngSubmit)="calculateBMI()" class="bmi-form">
            <input type="number" [(ngModel)]="bmiWeight" name="bmiWeight" placeholder="Weight (kg)" required min="1" />
            <input type="number" [(ngModel)]="bmiHeight" name="bmiHeight" placeholder="Height (cm)" required min="1" />
            <button type="submit">Calculate</button>
          </form>
          <div class="bmi-result" *ngIf="bmiResult">
            <p>Your BMI: <strong>{{ bmiResult }}</strong></p>
            <p class="bmi-category">{{ bmiCategory }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Meal Planning -->
    <div class="accordion-item">
      <div class="accordion-header" (click)="toggleSection('meal-plan')">
        <h2>üçΩÔ∏è Personalized Meal Plan</h2>
        <span class="accordion-icon">{{ openSection === 'meal-plan' ? '‚àí' : '+' }}</span>
      </div>
      <div class="accordion-body" *ngIf="openSection === 'meal-plan'">
        <div class="meal-planning-section">
          <h2>üçΩÔ∏è AI-Generated Meal Plan</h2>
          
          <!-- User Details Form -->
          <div class="user-details-form">
            <h3>Your Details</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>Age:</label>
                <input type="number" [(ngModel)]="userDetails.age" min="16" max="100" />
              </div>
              <div class="form-group">
                <label>Gender:</label>
                <select [(ngModel)]="userDetails.gender">
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                </select>
              </div>
              <div class="form-group">
                <label>Weight (kg):</label>
                <input type="number" [(ngModel)]="userDetails.weight" min="30" max="300" />
              </div>
              <div class="form-group">
                <label>Height (cm):</label>
                <input type="number" [(ngModel)]="userDetails.height" min="100" max="250" />
              </div>
              <div class="form-group">
                <label>Fitness Goal:</label>
                <select [(ngModel)]="userDetails.fitnessGoal">
                  <option value="lose">Lose Weight</option>
                  <option value="maintain">Maintain Weight</option>
                  <option value="gain">Gain Weight</option>
                </select>
              </div>
              <div class="form-group">
                <label>Diet Type:</label>
                <select [(ngModel)]="userDetails.dietType">
                  <option value="balanced">Balanced</option>
                  <option value="vegetarian">Vegetarian</option>
                  <option value="vegan">Vegan</option>
                  <option value="low-carb">Low-Carb</option>
                  <option value="high-protein">High-Protein</option>
                </select>
              </div>
            </div>
            <button (click)="generateMealPlan()" class="generate-btn">Generate Meal Plan</button>
          </div>

          <!-- Meal Plan Display -->
          <div class="meal-plan-display" *ngIf="mealPlan">
            <div class="meal-plan-header">
              <h3>Your Daily Meal Plan</h3>
              <button (click)="regenerateMealPlan()" class="regenerate-btn">üîÑ New Plan</button>
            </div>
            
            <!-- Breakfast -->
            <div class="meal-card">
              <h4>üåÖ Breakfast ({{ mealPlan.breakfast.totalCalories }} cal)</h4>
              <div class="food-items">
                <div *ngFor="let food of mealPlan.breakfast.foods" class="food-item">
                  <span class="food-name">{{ food.name }}</span>
                  <span class="food-portion">{{ food.portion }}</span>
                  <span class="food-macros">{{ food.calories }} cal | P: {{ food.protein }}g | C: {{ food.carbs }}g | F: {{ food.fats }}g</span>
                </div>
              </div>
              <div class="meal-totals">
                <strong>Total: {{ mealPlan.breakfast.totalCalories }} cal | P: {{ mealPlan.breakfast.totalProtein }}g | C: {{ mealPlan.breakfast.totalCarbs }}g | F: {{ mealPlan.breakfast.totalFats }}g</strong>
              </div>
            </div>

            <!-- Morning Snack -->
            <div class="meal-card">
              <h4>‚òï Morning Snack ({{ mealPlan.morningSnack.totalCalories }} cal)</h4>
              <div class="food-items">
                <div *ngFor="let food of mealPlan.morningSnack.foods" class="food-item">
                  <span class="food-name">{{ food.name }}</span>
                  <span class="food-portion">{{ food.portion }}</span>
                  <span class="food-macros">{{ food.calories }} cal | P: {{ food.protein }}g | C: {{ food.carbs }}g | F: {{ food.fats }}g</span>
                </div>
              </div>
              <div class="meal-totals">
                <strong>Total: {{ mealPlan.morningSnack.totalCalories }} cal | P: {{ mealPlan.morningSnack.totalProtein }}g | C: {{ mealPlan.morningSnack.totalCarbs }}g | F: {{ mealPlan.morningSnack.totalFats }}g</strong>
              </div>
            </div>

            <!-- Lunch -->
            <div class="meal-card">
              <h4>üåû Lunch ({{ mealPlan.lunch.totalCalories }} cal)</h4>
              <div class="food-items">
                <div *ngFor="let food of mealPlan.lunch.foods" class="food-item">
                  <span class="food-name">{{ food.name }}</span>
                  <span class="food-portion">{{ food.portion }}</span>
                  <span class="food-macros">{{ food.calories }} cal | P: {{ food.protein }}g | C: {{ food.carbs }}g | F: {{ food.fats }}g</span>
                </div>
              </div>
              <div class="meal-totals">
                <strong>Total: {{ mealPlan.lunch.totalCalories }} cal | P: {{ mealPlan.lunch.totalProtein }}g | C: {{ mealPlan.lunch.totalCarbs }}g | F: {{ mealPlan.lunch.totalFats }}g</strong>
              </div>
            </div>

            <!-- Afternoon Snack -->
            <div class="meal-card">
              <h4>üçé Afternoon Snack ({{ mealPlan.afternoonSnack.totalCalories }} cal)</h4>
              <div class="food-items">
                <div *ngFor="let food of mealPlan.afternoonSnack.foods" class="food-item">
                  <span class="food-name">{{ food.name }}</span>
                  <span class="food-portion">{{ food.portion }}</span>
                  <span class="food-macros">{{ food.calories }} cal | P: {{ food.protein }}g | C: {{ food.carbs }}g | F: {{ food.fats }}g</span>
                </div>
              </div>
              <div class="meal-totals">
                <strong>Total: {{ mealPlan.afternoonSnack.totalCalories }} cal | P: {{ mealPlan.afternoonSnack.totalProtein }}g | C: {{ mealPlan.afternoonSnack.totalCarbs }}g | F: {{ mealPlan.afternoonSnack.totalFats }}g</strong>
              </div>
            </div>

            <!-- Dinner -->
            <div class="meal-card">
              <h4>üåô Dinner ({{ mealPlan.dinner.totalCalories }} cal)</h4>
              <div class="food-items">
                <div *ngFor="let food of mealPlan.dinner.foods" class="food-item">
                  <span class="food-name">{{ food.name }}</span>
                  <span class="food-portion">{{ food.portion }}</span>
                  <span class="food-macros">{{ food.calories }} cal | P: {{ food.protein }}g | C: {{ food.carbs }}g | F: {{ food.fats }}g</span>
                </div>
              </div>
              <div class="meal-totals">
                <strong>Total: {{ mealPlan.dinner.totalCalories }} cal | P: {{ mealPlan.dinner.totalProtein }}g | C: {{ mealPlan.dinner.totalCarbs }}g | F: {{ mealPlan.dinner.totalFats }}g</strong>
              </div>
            </div>

            <!-- Daily Summary -->
            <div class="daily-summary">
              <h4>üìä Daily Totals</h4>
              <div class="summary-grid">
                <div class="summary-item">
                  <span class="summary-label">Calories:</span>
                  <span class="summary-value">{{ mealPlan.dailyTotals.calories }}</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Protein:</span>
                  <span class="summary-value">{{ mealPlan.dailyTotals.protein }}g</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Carbs:</span>
                  <span class="summary-value">{{ mealPlan.dailyTotals.carbs }}g</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Fats:</span>
                  <span class="summary-value">{{ mealPlan.dailyTotals.fats }}g</span>
                </div>
              </div>
            </div>

            <!-- Health Tip -->
            <div class="health-tip">
              <h4>üí° AI Health Tip</h4>
              <p>{{ mealPlan.healthTip }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Achievements Section -->
    <div class="accordion-item">
      <div class="accordion-header" (click)="toggleSection('achievements')">
        <h2>Achievements</h2>
        <span class="accordion-icon">{{ openSection === 'achievements' ? '‚àí' : '+' }}</span>
      </div>
      <div class="accordion-body" *ngIf="openSection === 'achievements'">
        <div class="achievements-section">
          <h2>üèÜ Achievements</h2>
          
          <!-- Unlocked Achievements -->
          <div class="achievements-grid" *ngIf="getUnlockedAchievements().length > 0">
            <h3>Unlocked</h3>
            <div class="achievement-cards">
              <div *ngFor="let achievement of getUnlockedAchievements()" class="achievement-card unlocked">
                <div class="achievement-icon">{{ achievement.icon }}</div>
                <div class="achievement-info">
                  <h4>{{ achievement.name }}</h4>
                  <p>{{ achievement.description }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Locked Achievements -->
          <div class="achievements-grid">
            <h3>Locked</h3>
            <div class="achievement-cards">
              <div *ngFor="let achievement of getLockedAchievements()" class="achievement-card locked">
                <div class="achievement-icon">{{ achievement.icon }}</div>
                <div class="achievement-info">
                  <h4>{{ achievement.name }}</h4>
                  <p>{{ achievement.description }}</p>
                  <div class="achievement-progress">
                    <span>{{ achievement.current }}/{{ achievement.requirement }}</span>
                    <div class="achievement-bar">
                      <div class="achievement-fill" [style.width.%]="getAchievementProgress(achievement.current, achievement.requirement)"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Accordion Section End -->
</div>
